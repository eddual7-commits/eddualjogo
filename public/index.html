<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>eddual jogo</title>

<style>
body {
  margin: 0;
  background: #111;
  color: white;
  font-family: Arial;
  display: flex;
  flex-direction: column;
  align-items: center;
}

#menu {
  margin: 10px;
  display: flex;
  gap: 6px;
  flex-wrap: wrap;
  justify-content: center;
}

button, input {
  padding: 6px;
  font-size: 14px;
}

#roomCode {
  width: 100%;
  text-align: center;
  font-weight: bold;
}

canvas {
  background: #222;
  border: 2px solid #444;
}
</style>
</head>

<body>

<div id="menu">
  <div id="roomCode"></div>
  <button id="createBtn">Criar sala</button>
  <input id="roomInput" placeholder="Código">
  <button id="joinBtn">Entrar</button>
</div>

<canvas id="game"></canvas>

<script src="/socket.io/socket.io.js"></script>
<script>
const socket = io()

const canvas = document.getElementById("game")
const ctx = canvas.getContext("2d")

canvas.width = Math.min(innerWidth - 20, 420)
canvas.height = Math.min(innerHeight - 120, 420)

let roomId = null
let players = {}
let myId = null

socket.on("connect", () => {
  myId = socket.id
})

// UI
createBtn.onclick = () => socket.emit("createRoom")

joinBtn.onclick = () => {
  const code = roomInput.value.trim()
  if (code) {
    roomId = code
    socket.emit("joinRoom", code)
    roomCode.innerText = "Sala: " + code
  }
}

socket.on("roomCreated", id => {
  roomId = id
  roomCode.innerText = "Sala: " + id
  roomInput.value = id
})

socket.on("updatePlayers", data => {
  players = data
})

// INPUT — TAP PARA MOVER (FUNCIONA EM TODO CELULAR)
canvas.addEventListener("pointerdown", e => {
  if (!roomId) return
  const rect = canvas.getBoundingClientRect()
  const x = e.clientX - rect.left
  const y = e.clientY - rect.top
  socket.emit("move", { roomId, x, y })
})

// LOOP
function loop() {
  ctx.clearRect(0, 0, canvas.width, canvas.height)

  for (const id in players) {
    const p = players[id]
    ctx.fillStyle = id === myId ? "#4da6ff" : "#ffa94d"
    ctx.fillRect(p.x - 12, p.y - 12, 24, 24)
  }

  requestAnimationFrame(loop)
}
loop()
</script>

</body>
</html>
