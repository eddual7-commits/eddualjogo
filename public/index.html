<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>coop survival</title>
<style>
html, body {
  margin: 0;
  padding: 0;
  overflow: hidden;
  background: #0b0b0b;
  touch-action: none;
}
canvas {
  display: block;
}
</style>
</head>
<body>

<canvas id="game"></canvas>

<script src="/socket.io/socket.io.js"></script>
<script>
const socket = io()
const canvas = document.getElementById("game")
const ctx = canvas.getContext("2d")

function resize() {
  canvas.width = window.innerWidth
  canvas.height = window.innerHeight
}
resize()
window.addEventListener("resize", resize)

let roomId = null
let players = {}

const me = { x: 200, y: 200, vx: 0, vy: 0 }

// ───────────────
// BRAWL-STYLE JOYSTICK
// ───────────────
let joystick = {
  active: false,
  id: null,
  startX: 0,
  startY: 0,
  x: 0,
  y: 0
}

canvas.addEventListener("touchstart", e => {
  const t = e.changedTouches[0]
  joystick.active = true
  joystick.id = t.identifier
  joystick.startX = t.clientX
  joystick.startY = t.clientY
})

canvas.addEventListener("touchmove", e => {
  for (const t of e.changedTouches) {
    if (t.identifier === joystick.id) {
      joystick.x = t.clientX
      joystick.y = t.clientY
    }
  }
})

canvas.addEventListener("touchend", e => {
  joystick.active = false
  me.vx = me.vy = 0
})

// ───────────────
// ROOM CONTROLS
// ───────────────
socket.on("roomCreated", id => roomId = id)
socket.on("updatePlayers", p => players = p)

// auto cria sala se entrar sozinho
<div id="menu" style="
  position: fixed;
  top: 10px;
  left: 50%;
  transform: translateX(-50%);
  z-index: 10;
  text-align: center;
">
  <button onclick="createRoom()">Criar sala</button>
  <input id="roomInput" placeholder="Sala" />
  <button onclick="joinRoom()">Entrar</button>
</div>

// ───────────────
// UPDATE
// ───────────────
function update() {
  if (!roomId) return

  if (joystick.active) {
    const dx = joystick.x - joystick.startX
    const dy = joystick.y - joystick.startY
    const dist = Math.min(Math.hypot(dx, dy), 60)

    const angle = Math.atan2(dy, dx)
    me.vx = Math.cos(angle) * (dist / 10)
    me.vy = Math.sin(angle) * (dist / 10)
  }

  me.x += me.vx
  me.y += me.vy

  socket.emit("move", {
    roomId,
    x: me.x,
    y: me.y
  })
}

// ───────────────
// DRAW
// ───────────────
function draw() {
  ctx.clearRect(0,0,canvas.width,canvas.height)

  // players
  for (const id in players) {
    const p = players[id]
    ctx.fillStyle = id === socket.id ? "#4af" : "#fa4"
    ctx.beginPath()
    ctx.arc(p.x, p.y, 18, 0, Math.PI*2)
    ctx.fill()
  }

  // joystick
  if (joystick.active) {
    ctx.strokeStyle = "rgba(255,255,255,0.3)"
    ctx.lineWidth = 2
    ctx.beginPath()
    ctx.arc(joystick.startX, joystick.startY, 40, 0, Math.PI*2)
    ctx.stroke()

    ctx.fillStyle = "rgba(255,255,255,0.4)"
    ctx.beginPath()
    ctx.arc(joystick.x, joystick.y, 20, 0, Math.PI*2)
    ctx.fill()
  }
}

// ───────────────
// LOOP
// ───────────────
function loop() {
  update()
  draw()
  requestAnimationFrame(loop)
}
loop()
</script>

</body>
</html>
<div id="menu" style="
  position: fixed;
  top: 10px;
  left: 50%;
  transform: translateX(-50%);
  z-index: 10;
  text-align: center;
">
  <button onclick="createRoom()">Criar sala</button>
  <input id="roomInput" placeholder="Sala" />
  <button onclick="joinRoom()">Entrar</button>
</div>
